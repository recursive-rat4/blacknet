#!/bin/false
#
# Copyright (c) 2020 Pavel Vasin
#
# Licensed under the Jelurida Public License version 1.1
# for the Blacknet Public Blockchain Platform (the "License");
# you may not use this file except in compliance with the License.
# See the LICENSE.txt file at the top-level directory of this distribution.
#

image: eclipse-temurin:17.0.7_7-jdk@sha256:da794e3718439e4acb1798655a6341f42bc7f2d369c01da75f9d6ec4d6e8069a

include:
  - template: License-Scanning.gitlab-ci.yml

variables:
  GRADLE_USER_HOME: ".gradle"

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches

stages:
  - license_scanning
  - test
  - build

license_scanning:
  stage: license_scanning
  allow_failure: false
  artifacts:
    reports:
      license_scanning: gl-license-scanning-report.json

test:
  stage: test
  script:
    - ./gradlew test
  artifacts:
    reports:
      junit:
        - build/test-results/test/TEST-*.xml
        - json-rpc/build/test-results/test/TEST-*.xml
        - runtime/build/test-results/test/TEST-*.xml
        - serialization/build/test-results/test/TEST-*.xml
        - time/build/test-results/test/TEST-*.xml

build:
  stage: build
  script:
    - ./gradlew distTar
    - tar -xf build/distributions/blacknet-*.*.*.tar
  rules:
    - if: $CI_COMMIT_TAG
      when: on_success
    - when: never
  artifacts:
    name: blacknet-gitlab-build
    paths:
      - blacknet-*.*.*
